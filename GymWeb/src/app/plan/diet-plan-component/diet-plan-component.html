<div class="diet-container">
  <!-- Header -->
  <div class="diet-header">
    <div class="header-content">
      <h1><i class="fas fa-utensils"></i> Your <span>Diet</span> Plan</h1>
      <p *ngIf="userProfile">
        Personalized nutrition plan for {{ userProfile.name }}
      </p>
    </div>
    <div class="header-actions">
      <button
        class="action-btn"
        (click)="regenerateDietPlan()"
        [disabled]="isLoading"
      >
        <i class="fas fa-sync-alt" [class.fa-spin]="isLoading"></i>
        Regenerate Plan
      </button>
      <button class="action-btn secondary" routerLink="/plan-dashboard">
        <i class="fas fa-home"></i> Dashboard
      </button>
    </div>
  </div>

  <!-- Diet Overview -->
  <div class="diet-overview" *ngIf="dietPlan">
    <div class="overview-cards">
      <div class="overview-card calories">
        <div class="card-icon"><i class="fas fa-fire"></i></div>
        <div class="card-content">
          <h3>
            {{
              getDailyCalorieTarget() !== 0
                ? (getDailyCalorieTarget() | number : "1.0-0")
                : "--"
            }}
          </h3>
          <p>Daily Calories</p>
        </div>
      </div>
      <div class="overview-card protein">
        <div class="card-icon"><i class="fas fa-drumstick-bite"></i></div>
        <div class="card-content">
          <h3>
            {{
              getDailyProteinTarget() !== 0
                ? (getDailyProteinTarget() | number : "1.0-0")
                : "--"
            }}g
          </h3>
          <p>Daily Protein</p>
        </div>
      </div>
      <div class="overview-card carbs">
        <div class="card-icon"><i class="fas fa-bread-slice"></i></div>
        <div class="card-content">
          <h3>
            {{
              getDailyCarbsTarget() !== 0
                ? (getDailyCarbsTarget() | number : "1.0-0")
                : "--"
            }}g
          </h3>
          <p>Daily Carbs</p>
        </div>
      </div>
      <div class="overview-card fat">
        <div class="card-icon"><i class="fas fa-cheese"></i></div>
        <div class="card-content">
          <h3>
            {{
              getDailyFatTarget() !== 0
                ? (getDailyFatTarget() | number : "1.0-0")
                : "--"
            }}g
          </h3>
          <p>Daily Fat</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Day Selector -->
  <div class="day-selector" *ngIf="dietPlan?.dailyPlans?.length">
    <div class="day-tabs">
      <button
        *ngFor="let day of dietPlan?.dailyPlans || []; let i = index"
        [class.active]="selectedDayIndex === i"
        (click)="selectDay(i, 'day-details')"
        class="day-tab"
      >
        <span class="day-name">{{ day.dayName }}</span>
        <span class="day-calories"
          >{{ day.totalDailyCalories | number : "1.0-0" }} kcal</span
        >
      </button>
    </div>
  </div>

  <!-- Selected Day Details -->
  <div class="day-details" *ngIf="selectedDay" id="day-details">
    <div class="day-summary">
      <h2>{{ selectedDay.dayName }} - Day {{ selectedDay.dayNumber }}</h2>

      <div class="macro-progress">
        <div class="macro-item">
          <div class="macro-header">
            <span>Calories</span>
            <span>
              {{ selectedDay.totalDailyCalories | number : "1.0-0" }} /
              {{ getDailyCalorieTarget() | number : "1.0-0" }}
            </span>
          </div>
          <div class="progress-bar">
            <div
              class="progress-fill calories-fill"
              [style.width.%]="
                getProgressPercentage(
                  selectedDay.totalDailyCalories,
                  getDailyCalorieTarget()
                )
              "
            ></div>
          </div>
        </div>

        <div class="macro-item">
          <div class="macro-header">
            <span>Protein</span>
            <span>
              {{ selectedDay.totalDailyProtein | number : "1.0-0" }}g /
              {{ getDailyProteinTarget() | number : "1.0-0" }}g
            </span>
          </div>
          <div class="progress-bar">
            <div
              class="progress-fill protein-fill"
              [style.width.%]="
                getProgressPercentage(
                  selectedDay.totalDailyProtein,
                  getDailyProteinTarget()
                )
              "
            ></div>
          </div>
        </div>

        <div class="macro-item">
          <div class="macro-header">
            <span>Carbs</span>
            <span>
              {{ selectedDay.totalDailyCarbs | number : "1.0-0" }}g /
              {{ getDailyCarbsTarget() | number : "1.0-0" }}g
            </span>
          </div>
          <div class="progress-bar">
            <div
              class="progress-fill carbs-fill"
              [style.width.%]="
                getProgressPercentage(
                  selectedDay.totalDailyCarbs,
                  getDailyCarbsTarget()
                )
              "
            ></div>
          </div>
        </div>

        <div class="macro-item">
          <div class="macro-header">
            <span>Fat</span>
            <span>
              {{ selectedDay.totalDailyFat | number : "1.0-0" }}g /
              {{ getDailyFatTarget() | number : "1.0-0" }}g
            </span>
          </div>
          <div class="progress-bar">
            <div
              class="progress-fill fat-fill"
              [style.width.%]="
                getProgressPercentage(
                  selectedDay.totalDailyFat,
                  getDailyFatTarget()
                )
              "
            ></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Meals Grid -->
    <div class="meals-grid">
      <div class="meal-card" *ngFor="let meal of selectedDay.meals">
        <div class="meal-header">
          <div class="meal-title">
            <i class="fas" [class]="getMealIcon(meal.mealType)"></i>
            <h3>{{ formatMealType(meal.mealType) }}</h3>
          </div>
          <div class="meal-calories">
            {{ meal.totalCalories | number : "1.0-0" }} kcal
          </div>
        </div>
        <div class="meal-macros">
          <span class="macro protein"
            >P: {{ meal.totalProtein | number : "1.0-0" }}g</span
          >
          <span class="macro carbs"
            >C: {{ meal.totalCarbs | number : "1.0-0" }}g</span
          >
          <span class="macro fat"
            >F: {{ meal.totalFat | number : "1.0-0" }}g</span
          >
        </div>
        <div class="food-items">
          <div class="food-item" *ngFor="let item of meal.foodItems">
            <div class="food-info">
              <div class="food-name">{{ item.foodName }}</div>
              <div class="food-details">
                <span class="quantity"
                  >{{ item.quantity | number : "1.0-0" }}g</span
                >
                <span
                  class="category"
                  [style.background-color]="getCategoryColor(item.category)"
                >
                  {{ formatCategory(item.category) }}
                </span>
              </div>
            </div>
            <div class="food-nutrition">
              <div class="nutrition-item">
                <span class="value">{{
                  item.calories | number : "1.0-0"
                }}</span>
                <span class="label">kcal</span>
              </div>
              <div class="nutrition-item">
                <span class="value">{{ item.protein | number : "1.0-0" }}</span>
                <span class="label">P</span>
              </div>
              <div class="nutrition-item">
                <span class="value">{{ item.carbs | number : "1.0-0" }}</span>
                <span class="label">C</span>
              </div>
              <div class="nutrition-item">
                <span class="value">{{ item.fat | number : "1.0-0" }}</span>
                <span class="label">F</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="loading-content">
      <div class="spinner"></div>
      <p>Loading your diet plan...</p>
    </div>
  </div>

  <!-- No Data State -->
  <div class="no-data" *ngIf="!dietPlan && !isLoading">
    <div class="no-data-content">
      <i class="fas fa-utensils"></i>
      <h2>No Diet Plan Found</h2>
      <p>Please generate a fitness plan first.</p>
      <button class="primary-btn" routerLink="/plan-dashboard">
        <i class="fas fa-home"></i>
        Go to Dashboard
      </button>
    </div>
  </div>
</div>
